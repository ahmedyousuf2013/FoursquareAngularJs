var app=angular.module("FoursquareApp",["ngRoute","ngResource","ui.bootstrap","toaster","chieffancypants.loadingBar"]);app.config(function(e){e.when("/explore",{controller:"placesExplorerController",templateUrl:"/app/views/placesresults.html"}),e.when("/places",{controller:"myPlacesController",templateUrl:"/app/views/myplaces.html"}),e.when("/places",{controller:"myPlacesController",templateUrl:"/app/views/myplaces.html"}),e.when("/countries",{controller:"countriesController",templateUrl:"/app/views/Countries.html"}),e.otherwise({redirectTo:"/explore"})}),app.controller("aboutController",function(e){}),app.controller("countriesController",function(t,n,e,r){function o(e){t.filteredCountries=n("CountryNameFilter")(t.Countries,e),t.filteredCountriesCount=t.filteredCountries.length}t.exploreNearby="USA",t.exploreQuery="",t.filterValue="",t.Countries=[],t.filteredCountries=[],t.filteredCountriesCount=0,r.getCountries(t.currentPage-1,t.pageSize).then(function(e){t.Countries=e.data;e=angular.fromJson(e.headers("x-pagination"));t.totalRecordsCount=e.TotalCount,o("")},function(e){}),t.$watch("filterValue",function(e){o(e)}),t.doSearch=function(){t.currentPage=1},t.pageChanged=function(e){t.currentPage=e}}),app.controller("myPlacesController",function(t,n){t.myPlaces=[],t.totalRecordsCount=0,t.pageSize=10,t.currentPage=1,n.getUserPlaces("test",t.currentPage-1,t.pageSize).then(function(e){t.myPlaces=e.data;e=angular.fromJson(e.headers("x-pagination"));t.totalRecordsCount=e.TotalCount},function(e){}),t.pageChanged=function(e){t.currentPage=e,(e=n.getUserInContext())&&n.getUserPlaces(e,t.currentPage-1,t.pageSize).then(function(e){t.myPlaces=e.data;e=angular.fromJson(e.headers("x-pagination"));t.totalRecordsCount=e.TotalCount},function(e){})}}),app.controller("navigationController",function(e,t,n){e.isActive=function(e){return t.path().substr(0,e.length)==e}}),app.controller("placesExplorerController",function(t,n,r,o,a,u){function i(){var e=t.pageSize*(t.currentPage-1);n.get({near:t.exploreNearby,query:t.exploreQuery,limit:t.pageSize,offset:e},function(e){e.response.groups?(t.places=e.response.groups[0].items,t.totalRecordsCount=e.response.totalResults,l("")):(t.places=[],t.totalRecordsCount=0)})}function l(e){t.filteredPlaces=a("placeNameCategoryFilter")(t.places,e),t.filteredPlacesCount=t.filteredPlaces.length}t.exploreNearby="New York",t.exploreQuery="",t.filterValue="",t.places=[],t.filteredPlaces=[],t.filteredPlacesCount=0,t.totalRecordsCount=0,t.pageSize=10,t.currentPage=1,t.$watch("filterValue",function(e){l(e)}),i(),t.doSearch=function(){t.currentPage=1,i()},t.pageChanged=function(e){t.currentPage=e,i()},t.showVenuePhotos=function(e,t){r.get({venueId:e},function(e){u.open({templateUrl:"app/views/placesphotos.html",controller:"placesPhotosController",resolve:{venueName:function(){return t},venuePhotos:function(){return e.response.photos.items}}}).result.then(function(){},function(){})})},t.buildCategoryIcon=function(e){return e.prefix+"44"+e.suffix},t.buildVenueThumbnail=function(e){return e.items[0].prefix+"128x128"+e.items[0].suffix},t.bookmarkPlace=function(e){o.getUserInContext()?o.savePlace(e).then(function(e){},function(e){}):u.open({templateUrl:"app/views/userprofile.html",controller:"userContextController",resolve:{venue:function(){return e}}})}}),app.controller("placesPhotosController",function(e,t,n,r){e.venueName=n,e.venuePhotos=r,e.close=function(){t.dismiss("cancel")},e.buildVenuePhoto=function(e){return e.prefix+"256x256"+e.suffix}}),app.controller("userContextController",function(e,t,n,r){e.venue=r,e.user={userName:""},e.close=function(){t.dismiss("cancel")},e.saveUser=function(){n.setUserInContext(e.user.userName),n.savePlace(r).then(function(){e.close()},function(){})}}),app.directive("fsUnique",function(o){return{restrict:"A",require:"ngModel",link:function(e,n,t,r){n.bind("blur",function(e){var t;r&&n.val()&&(t=n.val(),o.userExists(t).then(function(e){e=!("true"===e);t===n.val()&&r.$setValidity("unique",e)},function(){r.$setValidity("unique",!0)}))})}}}),app.filter("CountryNameFilter",function(){return function(e,t){if(!t)return e;var n=[];t=t.toLowerCase();for(var r=0;r<e.length;r++){var o=e[r];(-1<o.Name.toLowerCase().indexOf(t)||-1<o.Description.toLowerCase().indexOf(t))&&n.push(o)}return n}}),app.filter("placeNameCategoryFilter",function(){return function(e,t){if(!t)return e;var n=[];t=t.toLowerCase();for(var r=0;r<e.length;r++){var o=e[r];(-1<o.venue.name.toLowerCase().indexOf(t)||-1<o.venue.categories[0].shortName.toLowerCase().indexOf(t))&&n.push(o)}return n}}),app.factory("CountriesDataService",function(n,e){var t={};return t.getCountries=function(e,t){return n.get("https://localhost:44372/api/Countries/get",{params:{page:e,pageSize:t}}).then(function(e){return e})},t}),app.factory("placesDataService",function(r,n){var o="https://localhost:44372/api/places/",e={},a=null;return e.getUserInContext=function(){return a},e.setUserInContext=function(e){a=e},e.getUserPlaces=function(e,t,n){return r.get(o+"get",{params:{username:e,page:t,pageSize:n}}).then(function(e){return e})},e.userExists=function(e){return r.get("/api/users/"+e).then(function(e){return e.data})},e.savePlace=function(e){var t={userName:a,venueID:e.id,venueName:e.name,address:e.location.address,category:e.categories[0].shortName,rating:e.rating};return r.post(o,t).then(function(e){n.pop("success","Bookmarked Successfully","Place saved to your bookmark!")},function(e){return 304==e.status?n.pop("note","Already Bookmarked","Already bookmarked for user: "+t.userName):n.pop("error","Faield to Bookmark","Something went wrong while saving :-("),e})},e});var requestParms={clientId:"DO5JJHGXBODWHZUZ2W45T0S35PKJH3MCLC1SKF5U4X3VF4YA",clientSecret:"GF0PDCNGEKSU2GI4ANGBGBKTEUU0G3E3QYPO5YWFXRV33GY5",version:"20131230"};app.factory("placesExplorerService",function(e){return e("https://api.foursquare.com/v2/venues/:action",{action:"explore",client_id:requestParms.clientId,client_secret:requestParms.clientSecret,v:requestParms.version,venuePhotos:"1",callback:"JSON_CALLBACK"},{get:{method:"JSONP"}})});requestParms={clientId:"DO5JJHGXBODWHZUZ2W45T0S35PKJH3MCLC1SKF5U4X3VF4YA",clientSecret:"GF0PDCNGEKSU2GI4ANGBGBKTEUU0G3E3QYPO5YWFXRV33GY5",version:"20131230"};app.factory("placesPhotosService",function(e){return e("https://api.foursquare.com/v2/venues/:venueId/:action",{action:"photos",client_id:requestParms.clientId,client_secret:requestParms.clientSecret,v:requestParms.version,limit:"9",callback:"JSON_CALLBACK"},{get:{method:"JSONP"}})});